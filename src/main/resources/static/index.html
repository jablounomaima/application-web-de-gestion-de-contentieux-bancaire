<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirection...</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .loader {
            text-align: center;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        p {
            margin: 10px 0;
            opacity: 0.9;
        }
    </style>
</head>

<body>
    <div class="loader">
        <div class="spinner"></div>
        <h2>Redirection en cours...</h2>
        <p id="message">Vérification de votre connexion</p>
    </div>

    <script>
        const token = localStorage.getItem('token');
        const messageEl = document.getElementById('message');

        if (!token) {
            messageEl.textContent = 'Non connecté, redirection vers login...';
            setTimeout(() => {
                window.location.href = '/login.html';
            }, 1000);
        } else {
            messageEl.textContent = 'Chargement de votre dashboard...';

            // Récupérer les infos utilisateur
            fetch('/api/auth/me', {
                headers: { 'Authorization': 'Bearer ' + token }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Token invalide');
                    }
                    return response.json();
                })
                .then(userData => {
                    const dashboards = {
                        'ROLE_ADMIN': '/dashboards/admin.html',
                        'ROLE_AGENT_BANCAIRE': '/dashboards/agent.html',
                        'ROLE_VALIDATEUR_JURIDIQUE': '/dashboards/juridique.html',
                        'ROLE_AVOCAT': '/dashboards/avocat.html',
                        'ROLE_HUISSIER': '/dashboards/huissier.html',
                        'ROLE_EXPERT': '/dashboards/expert.html',
                        'ROLE_VALIDATEUR_FINANCIER': '/dashboards/financier.html'
                    };

                    const dashboard = dashboards[userData.role];

                    if (dashboard) {
                        messageEl.textContent = 'Redirection vers votre dashboard...';
                        setTimeout(() => {
                            window.location.href = dashboard;
                        }, 500);
                    } else {
                        messageEl.textContent = 'Rôle non reconnu';
                        setTimeout(() => {
                            window.location.href = '/login.html';
                        }, 2000);
                    }
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    localStorage.removeItem('token');
                    messageEl.textContent = 'Session expirée, reconnexion nécessaire...';
                    setTimeout(() => {
                        window.location.href = '/login.html';
                    }, 2000);
                });
        }
    </script>
</body>

</html>